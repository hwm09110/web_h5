(function(t,o){var n,e,i,a,c,s,l,d,r=function(){if(!(o(".dialog-wrap").length>0)){switch(clearTimeout(l),clearTimeout(d),s.onBeforeShow(),o("body").append(dialogWrapper=o('<div class="dialog-wrap '+s.dialogClass+'"></div>')),dialogWrapper.append(n=o('<div class="dialog-overlay"></div>'),e=o('<div class="dialog-content dialog-content-animate"></div>')),solveTapBug=o('<div class="solve-tap-bug" style="margin:0;padding:0;border:none;background:rgba(255,255,255,0.01); -webkit-tap-highlight-color:rgba(0,0,0,0); width:100%; height:100%; position:fixed; top:0px; left:0px;"></div>').insertBefore(dialogWrapper),s.type){case"alert":s.showTitle&&e.append(i=o('<div class="dialog-content-hd"><h4 class="dialog-content-title">'+s.titleText+"</h4></div>")),e.append(contentBd=o('<div class="dialog-content-bd">'+s.contentHtml+"</div>")),e.append(contentFt=o('<div class="dialog-content-ft"></div>')),contentFt.append(c=o('<button class="dialog-btn dialog-btn-ok '+s.buttonClass.ok+'" >'+s.buttonText.ok+"</button>"));break;case"confirm":s.showTitle&&e.append(i=o('<div class="dialog-content-hd"><h4 class="dialog-content-title">'+s.titleText+"</h4></div>")),e.append(contentBd=o('<div class="dialog-content-bd">'+s.contentHtml+"</div>")),e.append(contentFt=o('<div class="dialog-content-ft"></div>')),contentFt.append(a=o('<button class="dialog-btn dialog-btn-cancel '+s.buttonClass.cancel+'" >'+s.buttonText.cancel+"</button>"),c=o('<button class="dialog-btn dialog-btn-ok '+s.buttonClass.ok+'" >'+s.buttonText.ok+"</button>"));break;case"info":var t=s.contentHtml||'<img class="info-icon" src="'+s.infoIcon+'" alt="'+s.infoText+'" /><p class="info-text">'+s.infoText+"</p>";e.append(contentBd=o('<div class="dialog-content-bd">'+t+"</div>")),dialogWrapper.addClass("dialog-wrap-info"),e.addClass("dialog-content-info").removeClass("dialog-content-animate");break;case"tips":var r=s.contentHtml||(s.infoIcon?'<img class="info-icon" src="'+s.infoIcon+'" alt="'+s.infoText+'" />':"")+'<span class="info-text">'+s.infoText+"</span>";e.append(contentBd=o('<div class="dialog-content-bd">'+r+"</div>")),dialogWrapper.addClass("dialog-wrap-tips"),e.addClass("dialog-content-tips").removeClass("dialog-content-animate")}setTimeout(function(){dialogWrapper.addClass("dialog-wrap-show"),s.onShow(),f()},20),setTimeout(function(){g()},100)}},u=function(){v.tap(o(c),function(){return s.onClickOk(),o.dialog.close(),!1}),v.tap(o(a),function(){return s.onClickCancel(),o.dialog.close(),!1}),s.overlayClose&&v.tap(o(n),function(){o.dialog.close()}),s.autoClose>0&&p(),o(document).on("touchmove",function(t){return!o(dialogWrapper).find(o(t.target)).length}),h()},p=function(){clearTimeout(d),d=window.setTimeout(function(){o.dialog.close()},s.autoClose)},g=function(){var t=o(window).height();if(o(contentBd).removeAttr("style"),o(e).height()>=t-10){var n=o(i).height()+parseInt(o(i).css("margin-top"))+parseInt(o(i).css("margin-bottom"))+parseInt(o(i).css("padding-top"))+parseInt(o(i).css("padding-bottom")),a=o(contentFt).height()+parseInt(o(contentFt).css("margin-top"))+parseInt(o(contentFt).css("margin-bottom"))+parseInt(o(contentFt).css("padding-top"))+parseInt(o(contentFt).css("padding-bottom")),c=parseInt(o(contentBd).css("margin-top"))+parseInt(o(contentBd).css("margin-bottom"))+parseInt(o(contentBd).css("padding-top"))+parseInt(o(contentBd).css("padding-bottom")),s=t-n-a-c-50;o(contentBd).css({"max-height":s,"overflow-y":"auto"})}},f=function(){o(window).on("resize",function(){clearTimeout(t);var t=window.setTimeout(function(){g()},100)})},h=function(){var t={x:0,y:0,top:0,left:0};o(contentBd).on("touchstart",function(n){t.x=event.changedTouches[0].clientX,t.y=event.changedTouches[0].clientY,0==t.top&&(t.top=o(this).scrollTop()),0==t.left&&(t.left=o(this).scrollLeft())}).on("touchmove",function(n){o(this).scrollTop(t.top-event.changedTouches[0].clientY+t.y),o(this).scrollLeft(t.left-event.changedTouches[0].clientX+t.x)}).on("touchend",function(o){0==t.x&&0==t.y||(t={x:0,y:0,top:0,left:0}),o.preventDefault()})},v={tap:function(t,o){if("ontouchstart"in window||"ontouchstart"in document)var n=!0;else if(window.navigator.msPointerEnabled)var n=!0;if(n){var e,i;t.on("touchstart",function(t){var o=t.touches?t.touches[0]:t.originalEvent.touches[0];e=o.clientX,i=o.clientY}),t.on("touchend",function(t){var n=t.changedTouches?t.changedTouches[0]:t.originalEvent.changedTouches[0];endTx=n.clientX,endTy=n.clientY,Math.abs(e-endTx)<6&&Math.abs(i-endTy)<6&&o(),t.preventDefault()})}else t.on("click",function(t){o()})}};o.dialog=function(t){return s=o.extend({},o.fn.dialog.defaults,t),o.dialog.init(),this},o.dialog.init=function(){r(),u()},o.dialog.close=function(){s.onBeforeClosed(),dialogWrapper.removeClass("dialog-wrap-show"),l=setTimeout(function(){dialogWrapper.remove(),s.onClosed()},100),o(document).on("touchmove",function(t){return!0}),setTimeout(function(){solveTapBug.remove()},350)},o.dialog.update=function(t){t.infoText&&e.find(".info-text").html(t.infoText),t.infoIcon&&e.find(".info-icon").attr("src",t.infoIcon),t.autoClose>0&&window.setTimeout(function(){t.onBeforeClosed&&t.onBeforeClosed(),o.dialog.close(),t.onClosed&&t.onClosed()},t.autoClose)},o.fn.dialog=function(t){return this},o.fn.dialog.defaults={type:"alert",titleText:"信息提示",showTitle:!0,contentHtml:"",dialogClass:"",autoClose:0,overlayClose:!1,drag:!1,buttonText:{ok:"确定",cancel:"取消",delete:"删除"},buttonClass:{ok:"",cancel:"",delete:""},infoText:"",infoIcon:"",onClickOk:function(){},onClickCancel:function(){},onClickClose:function(){},onBeforeShow:function(){},onShow:function(){},onBeforeClosed:function(){},onClosed:function(){}}})(window,window.Zepto||window.jQuery);